<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Money Tracker ‚Äì Purse & Savings</title>
<!-- ‚ö†Ô∏è HEAD SECTION UNCHANGED -->
</head>

<body>
<div class="container">

<!-- ‚ö†Ô∏è BODY CONTENT UNCHANGED -->

<!-- üîΩ ONLY ADDITION: GitHub Buttons -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const row = document.querySelector(".actions-row");
  row.insertAdjacentHTML("beforeend", `
    <button type="button" class="btn btn-primary" onclick="saveToGitHub()">‚òÅÔ∏è Save to GitHub</button>
    <button type="button" class="btn btn-success" onclick="loadFromGitHub()">‚òÅÔ∏è Load from GitHub</button>
  `);
});
</script>

<!-- ‚ö†Ô∏è EXISTING SCRIPT CONTINUES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
/* ===============================
   GITHUB CLOUD SAVE (ADDED ONLY)
================================ */

const GITHUB_OWNER = "inspector3ug";
const GITHUB_REPO = "mymoney";
const GITHUB_PATH = "data/transactions.json";
const GITHUB_BRANCH = "main";

function askGithubToken() {
  const token = prompt(
    "GitHub Personal Access Token\n\n" +
    "‚Ä¢ Required: Contents Read & Write\n" +
    "‚Ä¢ Token is NOT stored\n"
  );
  if (!token || !token.startsWith("ghp_")) {
    alert("Invalid token.");
    return null;
  }
  return token;
}

async function getGithubSHA(token) {
  const res = await fetch(
    `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_PATH}`,
    { headers: { Authorization: `Bearer ${token}` } }
  );
  if (res.status === 404) return null;
  if (!res.ok) throw new Error("Failed to read repo");
  return (await res.json()).sha;
}

async function saveToGitHub() {
  const token = askGithubToken();
  if (!token) return;

  try {
    const sha = await getGithubSHA(token);
    const content = btoa(unescape(encodeURIComponent(JSON.stringify({
      savedAt: new Date().toISOString(),
      transactions
    }, null, 2))));

    const res = await fetch(
      `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_PATH}`,
      {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: "Update money tracker data",
          content,
          sha,
          branch: GITHUB_BRANCH
        })
      }
    );

    if (!res.ok) throw new Error();
    showStatus("Saved to GitHub ‚òÅÔ∏è", "success");
  } catch {
    showStatus("GitHub save failed", "error");
  }
}

async function loadFromGitHub() {
  const token = askGithubToken();
  if (!token) return;

  try {
    const res = await fetch(
      `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${GITHUB_PATH}`,
      { headers: { Authorization: `Bearer ${token}` } }
    );

    if (!res.ok) throw new Error();
    const data = JSON.parse(atob((await res.json()).content));

    if (!confirm(`Load ${data.transactions.length} transactions?\nThis replaces local data.`)) return;

    transactions = data.transactions;
    saveTransactions();
    renderSummary();
    renderTransactions();
    showStatus("Loaded from GitHub ‚òÅÔ∏è", "success");
  } catch {
    showStatus("GitHub load failed", "error");
  }
}
</script>

</div>
</body>
</html>
